import React, { useState, useEffect } from 'react';
import { Calculator, DollarSign, TrendingUp, Info } from 'lucide-react';

const EquityOptionsCalculator = () => {
  const [inputs, setInputs] = useState({
    optionValue: 75000,
    valuation: 250000000,
    sharePrice: 9.038,
    strikePrice: 2.51,
    futureValuation: 500000000
  });

  const [results, setResults] = useState({
    numberOfShares: 0,
    exerciseCost: 0,
    exercisePercentage: 0,
    potentialGain: 0,
    roi: 0,
    futureSharePrice: 0,
    futureValue: 0,
    futureGain: 0,
    futureRoi: 0
  });

  useEffect(() => {
    calculateResults();
  }, [inputs]);

  const calculateResults = () => {
    const { optionValue, sharePrice, strikePrice, valuation, futureValuation } = inputs;
    
    if (sharePrice <= 0 || strikePrice < 0) return;
    
    const numberOfShares = optionValue / sharePrice;
    const exerciseCost = numberOfShares * strikePrice;
    const exercisePercentage = (exerciseCost / optionValue) * 100;
    const potentialGain = (numberOfShares * sharePrice) - exerciseCost;
    const roi = exerciseCost > 0 ? ((potentialGain / exerciseCost) * 100) : 0;

    // Future value calculations
    const futureSharePrice = (sharePrice * futureValuation) / valuation;
    const futureValue = numberOfShares * futureSharePrice;
    const futureGain = futureValue - exerciseCost;
    const futureRoi = exerciseCost > 0 ? ((futureGain / exerciseCost) * 100) : 0;

    setResults({
      numberOfShares: Math.round(numberOfShares),
      exerciseCost: Math.round(exerciseCost),
      exercisePercentage: exercisePercentage,
      potentialGain: Math.round(potentialGain),
      roi: roi,
      futureSharePrice: futureSharePrice,
      futureValue: Math.round(futureValue),
      futureGain: Math.round(futureGain),
      futureRoi: futureRoi
    });
  };

  const handleInputChange = (field, value) => {
    const numValue = parseFloat(value) || 0;
    setInputs(prev => ({
      ...prev,
      [field]: numValue
    }));
  };

  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(amount);
  };

  const formatNumber = (num) => {
    return new Intl.NumberFormat('en-US').format(num);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-xl shadow-xl p-8">
          {/* Header */}
          <div className="text-center mb-8">
            <div className="flex items-center justify-center mb-4">
              <Calculator className="w-8 h-8 text-indigo-600 mr-3" />
              <h1 className="text-3xl font-bold text-gray-900">Equity Options Calculator</h1>
            </div>
            <p className="text-gray-600">Calculate exercise costs and potential returns for your stock options</p>
          </div>

          <div className="grid md:grid-cols-2 gap-8">
            {/* Input Section */}
            <div className="space-y-6">
              <h2 className="text-xl font-semibold text-gray-800 flex items-center">
                <DollarSign className="w-5 h-5 mr-2" />
                Option Details
              </h2>

              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Option Grant Value
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      value={inputs.optionValue}
                      onChange={(e) => handleInputChange('optionValue', e.target.value)}
                      className="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                      placeholder="75000"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Company Valuation
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      value={inputs.valuation}
                      onChange={(e) => handleInputChange('valuation', e.target.value)}
                      className="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                      placeholder="250000000"
                    />
                  </div>
                  <p className="text-xs text-gray-500 mt-1">Current company valuation (e.g., Series B)</p>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Preferred Share Price
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      step="0.001"
                      value={inputs.sharePrice}
                      onChange={(e) => handleInputChange('sharePrice', e.target.value)}
                      className="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                      placeholder="9.038"
                    />
                  </div>
                  <p className="text-xs text-gray-500 mt-1">Current fair market value per share</p>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Strike Price (Exercise Price)
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      step="0.01"
                      value={inputs.strikePrice}
                      onChange={(e) => handleInputChange('strikePrice', e.target.value)}
                      className="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                      placeholder="2.51"
                    />
                  </div>
                  <p className="text-xs text-gray-500 mt-1">Price you pay to exercise options (after discounts)</p>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Future Company Valuation (Optional)
                  </label>
                  <div className="relative">
                    <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                    <input
                      type="number"
                      value={inputs.futureValuation}
                      onChange={(e) => handleInputChange('futureValuation', e.target.value)}
                      className="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                      placeholder="500000000"
                    />
                  </div>
                  <p className="text-xs text-gray-500 mt-1">Projected future valuation for scenario analysis</p>
                </div>
              </div>
            </div>

            {/* Results Section */}
            <div className="space-y-6">
              <h2 className="text-xl font-semibold text-gray-800 flex items-center">
                <TrendingUp className="w-5 h-5 mr-2" />
                Calculation Results
              </h2>

              <div className="space-y-4">
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="text-sm text-gray-600 mb-1">Number of Shares</div>
                  <div className="text-2xl font-bold text-gray-900">
                    {formatNumber(results.numberOfShares)}
                  </div>
                </div>

                <div className="bg-indigo-50 rounded-lg p-4">
                  <div className="text-sm text-indigo-600 mb-1">Exercise Cost</div>
                  <div className="text-2xl font-bold text-indigo-900">
                    {formatCurrency(results.exerciseCost)}
                  </div>
                  <div className="text-sm text-indigo-600 mt-1">
                    {results.exercisePercentage.toFixed(1)}% of grant value
                  </div>
                </div>

                <div className="bg-green-50 rounded-lg p-4">
                  <div className="text-sm text-green-600 mb-1">Potential Gain (Current Value)</div>
                  <div className="text-2xl font-bold text-green-900">
                    {formatCurrency(results.potentialGain)}
                  </div>
                  <div className="text-sm text-green-600 mt-1">
                    {results.roi.toFixed(0)}% ROI if exercised today
                  </div>
                </div>

                <div className="bg-yellow-50 rounded-lg p-4">
                  <div className="text-sm text-yellow-600 mb-1">Break-even Analysis</div>
                  <div className="text-lg font-semibold text-yellow-900">
                    Share price needs: {formatCurrency(inputs.strikePrice)}+
                  </div>
                  <div className="text-sm text-yellow-600 mt-1">
                    Current spread: {formatCurrency(inputs.sharePrice - inputs.strikePrice)}/share
                  </div>
                </div>

                {inputs.futureValuation > inputs.valuation && (
                  <div className="bg-purple-50 rounded-lg p-4 border-2 border-purple-200">
                    <div className="text-sm text-purple-600 mb-1">Future Scenario ({formatCurrency(inputs.futureValuation/1000000)}M valuation)</div>
                    <div className="text-2xl font-bold text-purple-900">
                      {formatCurrency(results.futureGain)}
                    </div>
                    <div className="text-sm text-purple-600 mt-1">
                      {results.futureRoi.toFixed(0)}% ROI • {formatCurrency(results.futureSharePrice)}/share
                    </div>
                    <div className="text-xs text-purple-500 mt-2">
                      Total value: {formatCurrency(results.futureValue)}
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Summary Section */}
          <div className="mt-8 bg-blue-50 rounded-lg p-6">
            <div className="flex items-start">
              <Info className="w-5 h-5 text-blue-600 mr-3 mt-0.5" />
              <div>
                <h3 className="font-semibold text-blue-900 mb-2">Summary</h3>
                <p className="text-blue-800 text-sm leading-relaxed mb-3">
                  To exercise your full option grant of <strong>{formatCurrency(inputs.optionValue)}</strong>, 
                  you would need to pay <strong>{formatCurrency(results.exerciseCost)}</strong> for <strong>{formatNumber(results.numberOfShares)} shares</strong>. 
                  This represents <strong>{results.exercisePercentage.toFixed(1)}%</strong> of your grant's current value. 
                  At today's valuation, your options would be worth <strong>{formatCurrency(results.potentialGain)}</strong> more than the exercise cost.
                </p>
                {inputs.futureValuation > inputs.valuation && (
                  <p className="text-purple-800 text-sm leading-relaxed">
                    <strong>Future Scenario:</strong> If the company reaches a <strong>{formatCurrency(inputs.futureValuation/1000000)}M valuation</strong>, 
                    your {formatNumber(results.numberOfShares)} shares would be worth <strong>{formatCurrency(results.futureValue)}</strong>, 
                    giving you a potential gain of <strong>{formatCurrency(results.futureGain)}</strong> 
                    (a <strong>{results.futureRoi.toFixed(0)}% return</strong> on your {formatCurrency(results.exerciseCost)} exercise cost).
                  </p>
                )}
              </div>
            </div>
          </div>

          {/* Footer */}
          <div className="mt-6 text-center text-xs text-gray-500">
            <p>This calculator is for estimation purposes only. Consult with your financial advisor and review your option agreement for exact terms.</p>
          </div>
        </div>
      </div>
    </div>
  );
};
